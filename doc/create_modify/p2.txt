ğŸ“Œ PROMPT #2 â€” BACKEND API
Create / Modify Order (veritÃ , validazioni, edge case)

Devi implementare TUTTA la logica backend necessaria a supportare la pagina unica Create / Modify Order.
Il frontend NON Ã¨ affidabile: il backend Ã¨ lâ€™unica fonte di veritÃ .

ğŸ¯ OBIETTIVO

Il backend deve:

garantire coerenza assoluta dei dati

prevenire ordini invalidi

gestire ingredienti finiti / slot pieni

supportare create e modify con regole diverse

rispondere sempre con dati completi per il frontend

ğŸ§± ENDPOINT OBBLIGATORI
1ï¸âƒ£ GET ordine per MODIFY
GET /api/orders/{orderId}

Deve fare:

Verificare autenticazione

Verificare ownership dellâ€™ordine

Verificare che lo stato sia modificabile

Caricare:

ingredienti selezionati

ingredienti oggi disponibili

ingredienti non piÃ¹ disponibili

stato ordine

eventuali vincoli

Risposta (esempio concettuale):
{
  "order": {
    "id": 12,
    "status": "pending",
    "ingredients": [
      { "id": 1, "category": "bread" },
      { "id": 5, "category": "meat" }
    ]
  },
  "availability": {
    "ingredients": {
      "1": "available",
      "5": "unavailable"
    }
  }
}


âš ï¸ NON inventare campi non richiesti
âš ï¸ NON mandare immagini
âš ï¸ NON mandare slot (in modify non servono)

2ï¸âƒ£ POST Create Order
POST /api/orders

Input minimo richiesto:

time_slot_id

ingredients[]

Validazioni OBBLIGATORIE:

esattamente 1 bread

nessun ingrediente duplicato

ingredienti esistenti

ingredienti disponibili

slot esistente

slot non pieno

utente non ha giÃ  un ordine su quello slot (vincolo unique)

ğŸ‘‰ Se due utenti competono per lo stesso slot:

uno vince

lâ€™altro riceve 409 Conflict

NON rejected

3ï¸âƒ£ PUT Modify Order
PUT /api/orders/{orderId}

Regole:

NON modificare slot

NON modificare giorno

modificabili solo ingredienti

se ingrediente selezionato diventa non disponibile:

backend lo rimuove

frontend viene informato

ğŸ”’ TRANSAZIONI (NON OPZIONALI)

Create e Modify devono essere transaction-safe:

DB::transaction(function () {
  // validate
  // lock slot if needed
  // create/update order
});


Se una cosa fallisce â†’ rollback totale.

â›” STATI ORDINE (RISPETTA ALLA LETTERA)

pending â†’ modificabile

altri stati â†’ NON modificabile

rejected â†’ terminale

Il backend decide, il frontend obbedisce.

ğŸ§  LOGICA INGREDIENTI FINITI

Se durante:

polling

submit

modify

un ingrediente:

Ã¨ finito

o diventa non valido

ğŸ‘‰ il backend:

lo segnala come unavailable

NON accetta lâ€™ordine se Ã¨ obbligatorio

forza il frontend a disabilitarlo

ğŸ§ª DATI DI TEST (OBBLIGATORI)

Popolare il DB con dati sensati, non fake a caso:

Utenti

user1@gmail.com

user2@gmail.com

admin@gmail.com
Password: password

Ingredienti

ALMENO 2 per categoria:

bread

meat

cheese

vegetable

sauce

other

Ordini

storici realistici

giorni diversi

stati diversi

slot diversi

ğŸ‘‰ Senza dati credibili il frontend non Ã¨ testabile.

ğŸš« ERRORI DA NON COMMETTERE

âŒ validare solo lato frontend

âŒ accettare ingredienti duplicati

âŒ permettere modify su ordine non pending

âŒ lasciare slot pieno selezionabile

âŒ risposte API incomplete

âœ… OBIETTIVO FINALE

Dopo questo step:

create funziona

modify funziona

frontend non deve â€œindovinareâ€

nessun ordine inconsistente

edge case coperti

ğŸ”œ PROSSIMO PROMPT