PROMPT 3 ‚Äî Backend: contratto dati, query e polling per la pagina Admin ¬∑ Work Service
Contesto (vincolante)

Stiamo implementando la pagina Admin ‚Äì Work Service.
Il frontend esiste gi√† ed √® strutturato in modo modulare; questo prompt definisce solo:

quali endpoint backend devono esistere

che dati devono restituire

come devono supportare:

fetch iniziale

polling

modifica stato ordine

‚ùå NON parlare di UI
‚ùå NON parlare di componenti frontend
‚ùå NON parlare di layout
‚ùå NON introdurre logiche non richieste

Il backend deve solo rispondere correttamente alle esigenze della pagina.

PRINCIPI FONDAMENTALI (NON NEGOZIABILI)

Il backend √® stateless

Il backend non conosce selezioni UI

Il backend restituisce SEMPRE lo snapshot completo del giorno richiesto

Il polling NON deve causare side-effects

Il backend NON decide cosa √® selezionato

Il backend NON filtra in base allo stato selezionato

üëâ Tutta la logica di selezione e stabilit√† √® frontend, non backend.

STATI DELL‚ÄôORDINE (CONTRATTO FORMALE)

Gli stati possibili sono ESATTAMENTE:

pending

confirmed

ready

picked_up

Regole:

pending √® uno stato reale

pending non fa parte della pipeline di lavoro

pending deve essere visibile solo nei time slot

confirmed ‚Üí ready ‚Üí picked_up √® l‚Äôevoluzione naturale

Il backend deve permettere di forzare qualsiasi stato (admin override)

ENDPOINT 1 ‚Äî Fetch iniziale dati del giorno
GET /api/admin/work-service?date=YYYY-MM-DD
Scopo

Restituire tutti i dati necessari per lavorare su un giorno specifico.

Quando viene chiamato

al primo accesso alla pagina

quando l‚Äôadmin cambia giorno nello scheduler

Response (STRUTTURA OBBLIGATORIA)
{
  "date": "2026-01-17",

  "timeSlots": [
    {
      "id": 12,
      "start": "12:00",
      "end": "12:15",

      "ordersCount": {
        "pending": 3,
        "confirmed": 6,
        "ready": 4,
        "picked_up": 2
      },

      "orders": {
        "confirmed": [ ... ],
        "ready": [ ... ],
        "picked_up": [ ... ]
      }
    }
  ]
}

Struttura di un ordine (OBBLIGATORIA)
{
  "id": 13,
  "orderNumber": 13,
  "nickname": "Mario",
  "state": "confirmed",

  "ingredients": {
    "bread": ["CB"],
    "meat": ["PR"],
    "vegetable": ["RU", "PO"],
    "cheese": [],
    "sauce": ["MA"],
    "other": []
  }
}


Regole:

Le categorie devono esistere tutte

Se una categoria √® vuota ‚Üí array vuoto

L‚Äôordine degli ingredienti non √® rilevante

Le sigle sono gi√† pronte per la UI (no mapping frontend)

ENDPOINT 2 ‚Äî Polling (aggiornamento continuo)
GET /api/admin/work-service/poll?date=YYYY-MM-DD
Scopo

Restituire lo stesso identico payload del fetch iniziale.

‚ö†Ô∏è IMPORTANTISSIMO
Il polling NON deve:

riordinare dati

cambiare struttura

restituire delta

introdurre logica temporale

üëâ Il polling restituisce uno snapshot completo del giorno.

Regola chiave del polling

Se:

un ordine passa da pending ‚Üí confirmed

un nuovo pending appare

Il backend:

aggiorna i contatori

include l‚Äôordine nei dati

Il frontend:

decide cosa aggiornare e cosa no

non perde selezioni attive

ENDPOINT 3 ‚Äî Modifica stato ordine (ADMIN)
POST /api/admin/orders/{orderId}/state
Payload
{
  "state": "ready"
}

Comportamento richiesto

Validare che lo stato sia uno dei 4 consentiti

Aggiornare immediatamente l‚Äôordine

Restituire l‚Äôordine aggiornato

{
  "success": true,
  "order": {
    "id": 13,
    "state": "ready"
  }
}


‚ùå Nessun redirect
‚ùå Nessun side-effect
‚ùå Nessun batching

ORDINAMENTO ORDINI (VINCOLO ASSOLUTO)

Per ogni timeSlot.orders.{state}:

gli ordini devono essere ordinati per:

orderNumber ASC


Esempio:

2, 4, 7, 19


Il backend deve garantire questo ordinamento.

COSA IL BACKEND NON DEVE FARE

‚ùå Nascondere pending
‚ùå Decidere quale time slot √® selezionato
‚ùå Decidere quale ordine √® selezionato
‚ùå Filtrare per stato selezionato
‚ùå Ottimizzare per UI

OBIETTIVO DI QUESTO PROMPT

L‚ÄôIA di coding backend deve:

Implementare esattamente questi endpoint

Rispettare alla lettera il contratto dati

Non introdurre campi extra

Non cambiare nomi

Non semplificare strutture

Questo prompt non riguarda:

rendering

UX

componenti

layout

polling frontend